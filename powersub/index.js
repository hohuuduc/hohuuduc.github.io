var e,t;let n;function r(t,n,r){let d=Math.ceil(t/33)-1;console.log(d);for(let t=0;t<n.length;t++)t<=d?n[t].setAttribute(e.hidden,"false"):n[t].setAttribute(e.hidden,"true");r.setAttribute(e.hidden,t>0?"true":"false")}(t=e||(e={})).state="data-state",t.playing="data-playing",t.actived="data-actived",t.hidden="data-hidden";const d=document.getElementById("drop_zone"),l=document.getElementById("input-file"),a=document.getElementById("progress-container"),i=document.getElementById("progress"),o=document.getElementById("drop_zone"),s=document.getElementById("video-player"),u=document.getElementById("time-display"),c=u.querySelector(".current"),m=document.getElementById("subtitles"),p=document.getElementById("video-container"),v=document.getElementById("main-container"),f=document.getElementById("overlay"),y=document.getElementById("play-btn"),g=document.getElementById("controls"),E=document.getElementById("speaker");function h(e){if("string"==typeof e){let[t,n,r]=e.split(":");return 3600*parseInt(t)+60*parseInt(n)+parseFloat(r)}if("number"==typeof e){let t=Math.floor(e/3600).toString().padStart(2,"0"),n=Math.floor(e%3600/60).toString().padStart(2,"0"),r=Math.floor(e%60).toString().padStart(2,"0");return`${t}:${n}:${r}`}return null}d.ondrop=e=>{e.preventDefault(),e.dataTransfer&&I(e.dataTransfer.files)},d.ondragover=e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},l.addEventListener("change",function(){this.files&&I(this.files)}),o.addEventListener("click",function(){l.click()});let L=0;const b=[];async function I(e){for(let t=0;t<e.length;t++){let n=e[t];if(n.type.startsWith("video/")){p.style.display="block",s.src=URL.createObjectURL(n),s.style.display="block";return}["vtt","srt"].includes(n.name.split(".").pop())?b.push(...function(e){let t=[],n=0,r=0,d="";for(let l of e.split("\n"))if(l.includes("-->")){let e=l.split(" --> ");n=h(e[0]),r=h(e[1]),d=""}else""===l.trim()?(t.push({start:n,end:r,text:d}),n=r=0,d=""):(""!==d.trim()&&(d+="\n"),d+=l);return""!==d.trim()&&t.push({start:n,end:r,text:d}),t}(await n.text())):alert("Please only input video or subtitle files (support vtt/srt)")}}document.getElementById("deplay")?.addEventListener("change",e=>{L=e.target.valueAsNumber}),s.addEventListener("timeupdate",()=>{let{duration:e,currentTime:t}=s,n=b.find(e=>t>=e.start+L&&t<=e.end+L);console.log(t,n?.text),m.innerHTML=n?n.text:"",i.style.width=`${t/e*100}%`,c.innerText=h(t)}),s.addEventListener("loadedmetadata",()=>{u.querySelector(".duration").innerText=h(s.duration)}),s.addEventListener("play",()=>{p.setAttribute(e.playing,"true")}),s.addEventListener("pause",()=>{p.setAttribute(e.playing,"false")});let A=!1;function B(e){s.currentTime=e.offsetX/a.clientWidth*s.duration}function k(e,t){e.currentTime+=t}function S(){g.setAttribute(e.actived,"true"),clearTimeout(n),n=setTimeout(()=>{g.setAttribute(e.actived,"false")},2e3)}a.addEventListener("click",B),a.addEventListener("mousedown",()=>{A=!0}),a.addEventListener("mouseup",e=>{A=!1,B(e)}),a.addEventListener("mousemove",e=>{A&&B(e)}),a.addEventListener("mouseleave",()=>{A&&(A=!1)}),window.addEventListener("keydown",e=>{"ArrowLeft"===e.key?k(s,-5):"ArrowRight"===e.key&&k(s,5)}),y.addEventListener("click",()=>{s.paused?s.play():s.pause()}),y.addEventListener("dblclick",()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}),document.addEventListener("fullscreenchange",t=>{document.fullscreenElement?v.setAttribute(e.state,"fullscreen"):v.setAttribute(e.state,"none")}),f.addEventListener("mousemove",S),f.addEventListener("mousedown",S),f.addEventListener("mouseleave",()=>{clearTimeout(n),g.setAttribute(e.actived,"false")}),function({elm:e,rangeChange:t,stateChange:n}){let d=e.querySelector("svg"),l=e.querySelector(".range"),a=Array.from(d.querySelectorAll(".volume")),i=a.slice(0,3);l.addEventListener("input",()=>{let e=parseInt(l.value);t(e/100),r(e,i,a[3])}),d.addEventListener("click",()=>{let e=n();l.value=(100*e).toString(),r(100*e,i,a[3])})}({elm:E,rangeChange:e=>{s.muted=!1,s.volume=e},stateChange:()=>(s.muted=!(0==s.volume||s.muted),s.muted||0!=s.volume||(s.volume=1),s.muted?0:s.volume)});